<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Or√ßaf√°cil METLAL</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body, input, select, button {
      font-family: 'Arial', sans-serif;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
    }
    button:hover {
      background: #0056b3;
    }
    .total {
      font-weight: bold;
      color: green;
      font-size: 1.2em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Or√ßaf√°cil METLAL</h2>
  
  <label>Cliente:</label>
  <input id="cliente" type="text" />

  <label>N√∫mero do Or√ßamento:</label>
  <input id="numero" type="text" />

  <label>Data:</label>
  <input id="data" type="date" />

  <label>Produto:</label>
  <input id="produto" type="text" placeholder="Ex: Port√£o de ferro" />

  <label>Quantidade:</label>
  <input id="quantidade" type="number" value="1" min="1" />

  <label>Pre√ßo Unit√°rio:</label>
  <input id="preco" type="number" value="0" step="0.01" />

  <button onclick="adicionarProduto()">Adicionar Produto</button>

  <div id="listaProdutos"></div>

  <p class="total" id="total">Total: R$ 0,00</p>

  <button onclick="gerarPDF()">üìÑ Gerar PDF</button>
</div>

<script>
  const lista = [];
  const listaDiv = document.getElementById("listaProdutos");
  const totalSpan = document.getElementById("total");

  function adicionarProduto() {
    const nome = document.getElementById("produto").value;
    const qtd = parseInt(document.getElementById("quantidade").value);
    const preco = parseFloat(document.getElementById("preco").value);

    if (!nome || qtd <= 0 || preco <= 0) return alert("Preencha todos os dados corretamente.");

    lista.push({ nome, qtd, preco, subtotal: qtd * preco });
    atualizarLista();
  }

  function atualizarLista() {
    let html = "<ul>";
    let total = 0;

    lista.forEach((item, index) => {
      total += item.subtotal;
      html += `<li>${item.nome} x${item.qtd} - R$ ${item.subtotal.toFixed(2)}
                <button onclick="remover(${index})">‚ùå</button></li>`;
    });

    html += "</ul>";
    listaDiv.innerHTML = html;
    totalSpan.textContent = `Total: R$ ${total.toFixed(2)}`;
  }

  function remover(index) {
    lista.splice(index, 1);
    atualizarLista();
  }

  async function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const cliente = document.getElementById("cliente").value;
    const numero = document.getElementById("numero").value;
    const data = document.getElementById("data").value;

    let total = 0;

    // Logo (adicione depois com base64)
    // doc.addImage('data:image/png;base64,...', 'PNG', 10, 10, 40, 20);

    doc.setFontSize(12);
    doc.text(`Cliente: ${cliente}`, 10, 30);
    doc.text(`N¬∫ Or√ßamento: ${numero}`, 10, 38);
    doc.text(`Data: ${data}`, 10, 46);

    const headers = [["Produto", "Quantidade", "Pre√ßo Unit√°rio", "Subtotal"]];
    const rows = lista.map(item => {
      total += item.subtotal;
      return [item.nome, item.qtd, `R$ ${item.preco.toFixed(2)}`, `R$ ${item.subtotal.toFixed(2)}`];
    });

    doc.autoTable({
      startY: 55,
      head: headers,
      body: rows,
      theme: 'grid',
      styles: { halign: 'center' },
      headStyles: { fillColor: [0, 123, 255] }
    });

    doc.setFontSize(14);
    doc.setTextColor(0, 128, 0);
    doc.text(`TOTAL: R$ ${total.toFixed(2)}`, 10, doc.lastAutoTable.finalY + 15);

    doc.save(`${numero || "orcamento"}.pdf`);
  }
</script>
</body>
</html>
